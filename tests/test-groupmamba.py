from vla.Blocks import GroupMambaBlock
from torchsummary import summary

if __name__ == "__main__":
    model = GroupMambaBlock(
        dim=64
    ).cuda()

    summary(model, (64, 128, 128), device='cuda')

'''
----------------------------------------------------------------
        Layer (type)               Output Shape         Param #
================================================================
         LayerNorm-1            [-1, 16384, 64]             128
            Linear-2                    [-1, 4]             260
              ReLU-3                    [-1, 4]               0
            Linear-4                   [-1, 64]             320
           Sigmoid-5                   [-1, 64]               0
            Linear-6         [-1, 128, 128, 64]           1,024
              SiLU-7         [-1, 128, 128, 32]               0
            Conv2d-8         [-1, 32, 128, 128]             320
              SiLU-9         [-1, 32, 128, 128]               0
        LayerNorm-10         [-1, 128, 128, 32]              64
         Identity-11         [-1, 128, 128, 32]               0
           Linear-12         [-1, 128, 128, 16]             512
         Identity-13         [-1, 128, 128, 16]               0
             SS2D-14         [-1, 128, 128, 16]               0
           Linear-15         [-1, 128, 128, 64]           1,024
             SiLU-16         [-1, 128, 128, 32]               0
           Conv2d-17         [-1, 32, 128, 128]             320
             SiLU-18         [-1, 32, 128, 128]               0
        LayerNorm-19         [-1, 128, 128, 32]              64
         Identity-20         [-1, 128, 128, 32]               0
           Linear-21         [-1, 128, 128, 16]             512
         Identity-22         [-1, 128, 128, 16]               0
             SS2D-23         [-1, 128, 128, 16]               0
           Linear-24         [-1, 128, 128, 64]           1,024
             SiLU-25         [-1, 128, 128, 32]               0
           Conv2d-26         [-1, 32, 128, 128]             320
             SiLU-27         [-1, 32, 128, 128]               0
        LayerNorm-28         [-1, 128, 128, 32]              64
         Identity-29         [-1, 128, 128, 32]               0
           Linear-30         [-1, 128, 128, 16]             512
         Identity-31         [-1, 128, 128, 16]               0
             SS2D-32         [-1, 128, 128, 16]               0
           Linear-33         [-1, 128, 128, 64]           1,024
             SiLU-34         [-1, 128, 128, 32]               0
           Conv2d-35         [-1, 32, 128, 128]             320
             SiLU-36         [-1, 32, 128, 128]               0
        LayerNorm-37         [-1, 128, 128, 32]              64
         Identity-38         [-1, 128, 128, 32]               0
           Linear-39         [-1, 128, 128, 16]             512
         Identity-40         [-1, 128, 128, 16]               0
             SS2D-41         [-1, 128, 128, 16]               0
        LayerNorm-42            [-1, 16384, 64]             128
           Linear-43            [-1, 16384, 64]           4,160
  GroupMambaMixer-44            [-1, 16384, 64]               0
         Identity-45            [-1, 16384, 64]               0
        LayerNorm-46            [-1, 16384, 64]             128
           Linear-47           [-1, 16384, 256]          16,640
           Conv2d-48        [-1, 256, 128, 128]           2,560
           DWConv-49           [-1, 16384, 256]               0
             GELU-50           [-1, 16384, 256]               0
           Linear-51            [-1, 16384, 64]          16,448
          PVT2FFN-52            [-1, 16384, 64]               0
         Identity-53            [-1, 16384, 64]               0
================================================================
Total params: 48,452
Trainable params: 48,452
Non-trainable params: 0
----------------------------------------------------------------
Input size (MB): 4.00
Forward/backward pass size (MB): 336.00
Params size (MB): 0.18
Estimated Total Size (MB): 340.19
----------------------------------------------------------------
'''